"""
5-4折旧工作表详细分析报告
=====================================

## 表格结构

### 标题区域（第1-3行）
- 行1: 标题 "13-7 固定资产折旧费、成本摊销估算表 单位：万元"
- 行2: 列标题 - 序号、项目、合计、建设期(1-3)、运营期(4-20)
- 行3: 年份编号 - 1、2、3、4、5...20

### 数据区域（第4-39行）

#### 1. 建筑物（20年）- 第4-7行
- 第5行: 原值 = 79543.04万元（来自建设投资，建设期累计）
- 第6行: 当期折旧费 = 原值 / 20年 = 3778.29万元/年（从运营期第1年开始）
- 第7行: 净值 = 原值 - 累计折旧（逐年递减）

#### 2. 机器设备（10年）- 第8-11行
- 第9行: 原值 = 0万元（本示例无机器设备投资）
- 第10行: 当期折旧费 = 0
- 第11行: 净值 = 0

#### 3. 销售固定资产 - 第12-15行
- 第13行: 销售固定资产成本 = 26514.35万元（来自建设投资的一部分）
- 第14行: 固定资产成本摊销额（3年内摊销完成）
  - 运营期1: 2651.43万元
  - 运营期2-3: 7954.30万元/年
  - 运营期4-20: 0
- 第15行: 剩余待销售资产净值 = 成本 - 累计摊销

#### 4. 合计 - 第16-19行
- 第17行: 原值合计 = 建筑物原值 + 销售固定资产成本
- 第18行: 当期折旧、摊销 = 建筑物折旧 + 销售资产摊销
- 第19行: 净值合计 = 各项净值之和

## 计算逻辑分析

### 1. 建筑物折旧
- **原值来源**: 来自建设投资表中建筑物投资额的累计
- **折旧方法**: 直线法
- **折旧年限**: 20年
- **折旧公式**: 
  - 当期折旧 = 原值 / 20 = 79543.04 / 20 = 3778.29万元/年
  - 净值(t) = 原值 - 当期折旧 × (运营年份 - 建设年份)

### 2. 机器设备折旧
- **折旧年限**: 10年
- **折旧方法**: 直线法
- **本示例**: 无机器设备投资，因此为0

### 3. 销售固定资产摊销
- **摊销期限**: 3年（运营期第1-3年）
- **摊销方式**: 
  - 第1年: 10% (2651.43万元)
  - 第2-3年: 30% (7954.30万元/年)
  - 合计: 70%
- **剩余30%**: 作为期末回收资产

### 4. 合计计算
- **原值合计** = 建筑物原值 + 销售固定资产成本
- **当期折旧摊销合计** = 建筑物当期折旧 + 销售资产当期摊销
- **净值合计** = 建筑物净值 + 销售资产剩余净值

## 引用关系分析

### 与"1 建筑工程财务模型参数"的引用关系

需要从参数表中获取以下数据：
1. **建筑物折旧年限**: 20年（参数表中的设置）
2. **机器设备折旧年限**: 10年（参数表中的设置）
3. **销售固定资产摊销年限**: 3年（参数表中的设置）
4. **建设投资总额**: 用于分配到各资产类别

### 与"1建设投资"的引用关系

"5-4折旧"的原值来源于"1建设投资"表：
1. **建筑物原值**: = 建设投资中的建筑物投资额
2. **机器设备原值**: = 建设投资中的机器设备投资额
3. **销售固定资产成本**: = 建设投资中用于销售的成本

具体引用：
- 建筑物原值 (D5) = '1建设投资'!D[相应行][运营期期末]
- 机器设备原值 (D9) = '1建设投资'!D[相应行][运营期期末]
- 销售固定资产成本 (D13) = '1建设投资'!D[相应行][运营期期末]

### 与"5总成本"的引用关系

"5总成本"引用"5-4折旧"的当期折旧摊销：
- **总成本中的折旧摊销** = '5-4折旧'!D18（当期折旧、摊销合计）
- 这是总成本费用的重要组成部分

具体引用：
- 总成本表中的"折旧摊销"行 = '5-4折旧'!E[运营期]（对应年份的当期折旧、摊销）

### 与"7利润"的引用关系

"7利润"间接引用"5-4折旧"：
- **利润计算** = 收入 - 总成本费用
- 其中总成本费用包含折旧摊销
- 因此，利润受折旧摊销的影响

影响路径：
5-4折旧 → 5总成本 → 7利润

### 与"9资产负债"的引用关系

"9资产负债"直接引用"5-4折旧"的净值：
- **固定资产净值** = '5-4折旧'!D19（净值合计）
- 固定资产是资产的主要组成部分

具体引用：
- 资产负债表中的"固定资产净值"行 = '5-4折旧'!E[年份]（对应年份的净值合计）

## 固定资产折旧费估算表修改建议

### 需要确保的项

根据"5-4折旧"的结构，"固定资产折旧费估算表"应包含：

1. **建筑物折旧**
   - 原值
   - 当期折旧费
   - 净值

2. **机器设备折旧**
   - 原值
   - 当期折旧费
   - 净值

3. **销售固定资产摊销**
   - 销售固定资产成本
   - 固定资产成本摊销额
   - 剩余待销售资产净值

4. **合计**
   - 原值合计
   - 当期折旧、摊销
   - 净值合计

### 数据流关系图

```
1建设投资表
    ↓ (原值分配)
5-4折旧表 (折旧摊销计算)
    ↓ (当期折旧摊销)
5总成本表
    ↓ (总成本费用)
7利润表

5-4折旧表 (净值)
    ↓ (固定资产净值)
9资产负债表
```

### 关键计算参数

| 参数项 | 数值 | 来源 |
|--------|------|------|
| 建筑物折旧年限 | 20年 | 参数表 |
| 机器设备折旧年限 | 10年 | 参数表 |
| 销售资产摊销年限 | 3年 | 参数表 |
| 建设期 | 3年 | 参数表 |
| 运营期 | 17年 | 参数表 |

## 修改建议

### 1. 确保表格结构一致
"固定资产折旧费估算表"应该完全复制"5-4折旧"的：
- 标题行（第1-3行）
- 列结构（序号、项目、合计、建设期、运营期）
- 数据行结构（4个资产类别，每个类别包含3个子项）

### 2. 建立正确的引用关系
确保"固定资产折旧费估算表"：
- 原值正确引用建设投资表
- 折旧年限正确引用参数表
- 净值计算正确（原值 - 累计折旧摊销）

### 3. 验证计算逻辑
检查：
- 折旧公式是否正确（直线法）
- 摊销分配是否合理（销售资产3年摊销）
- 合计行是否正确汇总

### 4. 关联表数据验证
确保：
- "5总成本"中的折旧摊销与"5-4折旧"的合计一致
- "9资产负债"中的固定资产净值与"5-4折旧"的净值一致
- "7利润"的计算考虑了正确的折旧摊销

"""

# 生成Excel格式的详细分析
print(__doc__)
